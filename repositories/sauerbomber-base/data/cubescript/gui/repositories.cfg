newgui repositories [ guinoautotab [ guistayopen [
  if (= (getrepositoryworkers) 0) [
    guititle "List of Content Repositories"
    guibar
    guilist [
      guilist [
        guititle "Name"
        loopfiles _repositories_name $repositoriesdir "" [
          if (&& (&& (! (strcmp $_repositories_name ".")) (! (strcmp $_repositories_name ".."))) (! (strcmp $_repositories_name ".svn"))) [
            if (=s @_repositories_name $lookuprepository) [
              guibutton @@_repositories_name [
              ] "checkbox_on"
            ] [
              guibutton @@_repositories_name [
                lookuprepository @@@_repositories_name
                echo $lookuprepository
              ] "checkbox_off"
            ]
          ]
        ]
      ]
      guilist [
        guititle "Action"
        loopfiles _repositories_name $repositoriesdir "" [
          if (&& (&& (! (strcmp $_repositories_name ".")) (! (strcmp $_repositories_name ".."))) (! (strcmp $_repositories_name ".svn"))) [
            if (isrepositoryinternal @_repositories_name) [
              guitext "^f3internal^f~"
            ] [
              if (|| (= (isrepositoryupdateable @_repositories_name) 0) ) [
                guitext "^f2protected^f~"
              ] [
                guibutton "^f0update^f~" [
                  sleep 500 [
                    repositoryupdate @@@_repositories_name
                  ]
                ] "arrow_down"
              ]
            ]
          ]
        ]
      ]
    ]
    guibar
    guibutton "^f0update all^f~" updateallrepositories
    guitab "Add repository"
    guititle "Add repository"
    guibar
    guilist [
      guilist [
        guitext "name"
        guitext "url"
      ]
      guilist [
        guifield _repositories_add_name 40
        guifield _repositories_add_url 40
      ]
    ]
    guibar
    guibutton "Add" [
      repositorycheckout $_repositories_add_name $_repositories_add_url
    ] "arrow_fw"
    guitab "Advanced"
    guititle "Advanced Repository Actions"
    guibar
    guilist [
      guilist [
        guititle "Name"
        loopfiles _repositories_name $repositoriesdir "" [
          if (&& (&& (! (strcmp $_repositories_name ".")) (! (strcmp $_repositories_name ".."))) (! (strcmp $_repositories_name ".svn"))) [
            guitext @_repositories_name
          ]
        ]
      ]
      guilist [
        guititle "Unlock"
        loopfiles _repositories_name $repositoriesdir "" [
          if (&& (&& (! (strcmp $_repositories_name ".")) (! (strcmp $_repositories_name ".."))) (! (strcmp $_repositories_name ".svn"))) [
            if (isrepositoryinternal @_repositories_name) [
              guitext "^f3internal^f~"
            ] [
              if (|| (= (isrepositoryupdateable @_repositories_name) 0) ) [
                guitext "^f2protected^f~"
              ] [
                guibutton "^f0unlock^f~" [
                  sleep 500 [
                    repositoryunlock @@@_repositories_name
                  ]
                ] "checkbox_on"
              ]
            ]
          ]
        ]
      ]
      guilist [
        guititle "Remove"
        loopfiles _repositories_name $repositoriesdir "" [
          if (&& (&& (! (strcmp $_repositories_name ".")) (! (strcmp $_repositories_name ".."))) (! (strcmp $_repositories_name ".svn"))) [
            if (strcmp @_repositories_name "sauerbomber-base") [
              guitext "^f3internal^f~"
            ] [
              if (|| (= (isrepositoryupdateable @_repositories_name) 0) ) [
                guitext "^f2protected^f~"
              ] [
                guibutton "^f0remove^f~" [
                  sleep 500 [
                    removerepository @@@_repositories_name
                  ]
                ] "remove"
              ]
            ]
          ]
        ]
      ]
    ]
  ] [
    guistrut 10 5
    guititle "Updating Content Repository"
    loop workerid (getmaxrepositoryworkers) [
      if (= (isworkeractive $workerid) 1) [
        guibar
        guilist [
          guitext (workerrepositorytype @@workerid) 0
          guibar
          guitext (workerrepositoryname @@workerid) 0
          guibar
          guitext "Revision:"
          if (= (workerrepositoryrevision @@workerid) -1) [
            guitext "HEAD" 0
          ] [
            guitext (workerrepositoryrevision @@@workerid) 0
          ]
        ]
        guilist [
          guitext (workerrepositoryaction @@workerid) 0
          guibar
          guitext (workerrepositorypath @@workerid) 0
        ]
      ]
    ]
    guibar
    guitext "WARNING: DO NOT quit Sauerbomber while updating a content repository!"
    guitext "The update may take a while."
  ]
] ] ]

