newgui repositories [ guinoautotab [ guistayopen [
  if (= (getrepositoryworkers) 0) [
    guititle "List of Content Repositories"
    guibar
    guilist [
      guilist [
        guititle "Name"
        loopfiles _repositories_name "repositories" "" [
          if (&& (&& (! (strcmp $_repositories_name ".")) (! (strcmp $_repositories_name ".."))) (! (strcmp $_repositories_name ".svn"))) [
            guitext @_repositories_name
          ]
        ]
      ]
      guilist [
        guititle "Action"
        loopfiles _repositories_name "repositories" "" [
          if (&& (&& (! (strcmp $_repositories_name ".")) (! (strcmp $_repositories_name ".."))) (! (strcmp $_repositories_name ".svn"))) [
            if (isrepositoryinternal @_repositories_name) [
              guitext "^f3internal^f~"
            ] [
              if (|| (= (isrepositoryupdateable @_repositories_name) 0) ) [
                guitext "^f2protected^f~"
              ] [
                guibutton "^f0update^f~" [
                  sleep 500 [
                    repositoryupdate @@@_repositories_name
                  ]
                ] "arrow_down"
              ]
            ]
          ]
        ]
      ]
    ]
    guitab "Add repository"
    guititle "Add repository"
    guibar
    guilist [
      guilist [
        guitext "name"
        guitext "url"
      ]
      guilist [
        guifield _repositories_add_name 40
        guifield _repositories_add_url 40
      ]
    ]
    guibar
    guibutton "Add" [
      repositorycheckout $_repositories_add_name $_repositories_add_url
    ] "arrow_fw"
    guitab "Advanced"
    guititle "Advanced Repository Actions"
    guibar
    guilist [
      guilist [
        guititle "Name"
        loopfiles _repositories_name "repositories" "" [
          if (&& (&& (! (strcmp $_repositories_name ".")) (! (strcmp $_repositories_name ".."))) (! (strcmp $_repositories_name ".svn"))) [
            guitext @_repositories_name
          ]
        ]
      ]
      guilist [
        guititle "Unlock"
        loopfiles _repositories_name "repositories" "" [
          if (&& (&& (! (strcmp $_repositories_name ".")) (! (strcmp $_repositories_name ".."))) (! (strcmp $_repositories_name ".svn"))) [
            if (isrepositoryinternal @_repositories_name) [
              guitext "^f3internal^f~"
            ] [
              if (|| (= (isrepositoryupdateable @_repositories_name) 0) ) [
                guitext "^f2protected^f~"
              ] [
                guibutton "^f0unlock^f~" [
                  sleep 500 [
                    repositoryunlock @@@_repositories_name
                  ]
                ] "checkbox_on"
              ]
            ]
          ]
        ]
      ]
      guilist [
        guititle "Remove"
        loopfiles _repositories_name "repositories" "" [
          if (&& (&& (! (strcmp $_repositories_name ".")) (! (strcmp $_repositories_name ".."))) (! (strcmp $_repositories_name ".svn"))) [
            if (strcmp @_repositories_name "sauerbomber-base") [
              guitext "^f3internal^f~"
            ] [
              if (|| (= (isrepositoryupdateable @_repositories_name) 0) ) [
                guitext "^f2protected^f~"
              ] [
                guibutton "^f0remove^f~" [
                  sleep 500 [
                    removerepository @@@_repositories_name
                  ]
                ] "remove"
              ]
            ]
          ]
        ]
      ]
    ]
  ] [
    guistrut 10 5
    guititle "Updating Content Repository"
    guibar
    guilist [
      guitext (getrepositoryname)
      if (= (getrepositoryrevision) -1) [
        guitext "Revision: HEAD"
      ] [
        guitext (concat "Revision:" (getrepositoryrevision))
      ]
    ]
    guitext (getrepositorymsg)
    guibar
    guitext "WARNING: DO NOT quit Sauerbomber while updating a content repository!"
    guitext "The update may take a while."
  ]
] ] ]

