repositorynotexists = [
  notfound = 1
  loopfiles _repositories_name $repositoriesdir "" [
    if (= (strcmp $_repositories_name @arg1) 1) [
      notfound = 0
    ]
  ]
  result $notfound
]

isrepositoryupdateable = [
  found = 0
  loopfiles _repositories_name (concatword $repositoriesdir "/" $arg1 "/packages") "" [
    if (= (strcmp $_repositories_name ".svn") 1) [
      found = 1
    ]
  ]
  result $found
]

internalrepositories = [ "sauerbomber-base" "home" "edit" ]
isrepositoryinternal = [
  if (| (| (strcmp $arg1 "sauerbomber-base") (strcmp $arg1 "home")) (strcmp $arg1 "edit")) [
    result 1
  ] [
    result 0
  ]
]

updateallrepositories = [
  loopfiles _repositories_name $repositoriesdir "" [
    if (&& (&& (! (strcmp $_repositories_name ".")) (! (strcmp $_repositories_name ".."))) (! (strcmp $_repositories_name ".svn"))) [
      if (&& (= (isrepositoryinternal @_repositories_name) 0) (= (isrepositoryupdateable @_repositories_name) 1)) [
        repositoryupdate @@_repositories_name
      ]
    ]
  ]
]

repositorycheckoutifnotexists = [
  if (= (repositorynotexists $arg1) 1) [
    echo (concat "Repository" $arg1 "doesn't exist. Start checkout from" $arg2)
    repositorycheckout $arg1 $arg2
  ]
]

repositorycheckoutonceifnotexists = [
  if (= (repositorynotexists $arg1) 1) [
    echo (concat "Repository" $arg1 "doesn't exist. Start checkout fixed revision" $arg3 "from" $arg2)
    repositorycheckoutonce $arg1 $arg2 $arg3
  ]
]

initstdrepositories = [
  initstdrepositories_checkout = 0
  if (= (repositorynotexists "sauerbomber-content") 1) [
    initstdrepositoriescheckout = 1
    sleep 500 [
      repositorycheckoutifnotexists "sauerbomber-content" "http://content.sauerbomber.org"
    ]
  ]
  if (= (repositorynotexists "sauerbraten-justice") 1) [
    initstdrepositoriescheckout = 1
    sleep 500 [
      repositorycheckoutonceifnotexists "sauerbraten-justice" "https://sauerbraten.svn.sourceforge.net/svnroot/sauerbraten" 3225
    ]
  ]
  if (= (repositorynotexists "sauerbraten") 1) [
    initstdrepositoriescheckout = 1
    sleep 500 [
      repositorycheckoutifnotexists "sauerbraten" "https://sauerbraten.svn.sourceforge.net/svnroot/sauerbraten"
    ]
  ]
  if (= (repositorynotexists "maplounge") 1) [
    initstdrepositoriescheckout = 1
    sleep 500 [
      repositorycheckoutifnotexists "maplounge" "http://svn.maplounge.net/maps/justice"
    ]
  ]
  if (= (repositorynotexists "nooblauncher") 1) [
    initstdrepositoriescheckout = 1
    sleep 500 [
      repositorycheckoutifnotexists "nooblauncher" "https://nooblauncher.svn.sourceforge.net/svnroot/nooblauncher/trunk"
    ]
  ]
  if (= initstdrepositoriescheckout 1) [
    sleep 500 [
      showgui repositories
    ]
  ]
]

autoinitstdrepositories = [
    repositorycheckoutifnotexists "sauerbomber-content" "http://content.sauerbomber.org"
    repositorycheckoutonceifnotexists "sauerbraten-justice" "https://sauerbraten.svn.sourceforge.net/svnroot/sauerbraten" 3225
    // repositorycheckoutifnotexists "sauerbraten" "https://sauerbraten.svn.sourceforge.net/svnroot/sauerbraten"
    repositorycheckoutifnotexists "maplounge" "http://svn.maplounge.net/maps/justice"
    repositorycheckoutifnotexists "nooblauncher" "https://nooblauncher.svn.sourceforge.net/svnroot/nooblauncher/trunk"
]

repositoriescheckworkers = [
  if (> (getrepositoryworkers) 0) [
    showgui repositories
  ] [
    sleep 1000 [
      repositoriescheckworkers
    ]
  ]
]